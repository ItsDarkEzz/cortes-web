# Requirements Document

## Introduction

Техническое задание на разработку Telegram-бота CORTES — AI-ассистента для модерации и управления групповыми чатами. Бот предоставляет комплексный набор инструментов для автоматизации модерации, геймификации общения (RPG-система), фильтрации контента и управления участниками чата.

## Glossary

- **CORTES** — AI-бот для Telegram с функциями модерации и RPG-системой
- **Владелец (Owner)** — создатель чата с полными правами
- **Админ (Admin)** — пользователь с расширенными правами модерации
- **Модератор (Moderator)** — пользователь с базовыми правами модерации
- **Участник (Member)** — обычный пользователь чата
- **Предупреждение (Warning/Пред)** — штрафная отметка за нарушение правил
- **Face-контроль** — система проверки новых участников при вступлении
- **Стоп-слова** — запрещённые слова, при обнаружении которых сообщение удаляется
- **Тихий режим (Read-Only)** — режим, при котором писать могут только администраторы
- **Симпатия** — показатель отношения бота к пользователю в RPG-системе
- **NSFW** — контент для взрослых (Not Safe For Work)

---

## Requirements

### Requirement 1: Персонализация бота

**User Story:** Как владелец чата, я хочу настраивать имя и характер бота, чтобы он соответствовал тематике и атмосфере моего сообщества.

#### Acceptance Criteria

1. WHEN владелец изменяет имя бота в настройках THEN CORTES SHALL использовать новое имя во всех сообщениях в данном чате
2. WHEN владелец выбирает характер бота (дружелюбный/деловой/весёлый/строгий) THEN CORTES SHALL адаптировать стиль общения согласно выбранному характеру
3. WHEN владелец включает авто-ответы THEN CORTES SHALL самостоятельно участвовать в разговорах, отвечая на вопросы и комментарии участников
4. WHEN владелец отключает авто-ответы THEN CORTES SHALL реагировать только на прямые команды и упоминания

---

### Requirement 2: Приветствие новых участников

**User Story:** Как владелец чата, я хочу автоматически приветствовать новых участников, чтобы они чувствовали себя желанными гостями.

#### Acceptance Criteria

1. WHEN новый участник вступает в чат И приветствие включено THEN CORTES SHALL отправить настроенное приветственное сообщение
2. WHEN владелец редактирует текст приветствия THEN CORTES SHALL сохранить новый текст и использовать его для последующих приветствий
3. WHEN владелец отключает приветствие THEN CORTES SHALL прекратить отправку приветственных сообщений новым участникам

---

### Requirement 3: Сообщения при неактивности

**User Story:** Как владелец чата, я хочу чтобы бот оживлял чат при длительном молчании, чтобы поддерживать активность сообщества.

#### Acceptance Criteria

1. WHEN в чате отсутствует активность в течение заданного количества часов THEN CORTES SHALL отправить одно из заготовленных сообщений
2. WHEN владелец добавляет новое сообщение для неактивности THEN CORTES SHALL включить его в ротацию сообщений
3. WHEN владелец изменяет интервал неактивности THEN CORTES SHALL применить новый интервал для отслеживания активности
4. WHEN владелец отключает функцию THEN CORTES SHALL прекратить отправку сообщений при неактивности

---

### Requirement 4: Команды модерации

**User Story:** Как модератор, я хочу использовать команды для управления нарушителями, чтобы поддерживать порядок в чате.

#### Acceptance Criteria

1. WHEN модератор отправляет команду /ban с указанием пользователя и времени THEN CORTES SHALL заблокировать указанного пользователя на указанный срок
2. WHEN модератор отправляет команду /unban THEN CORTES SHALL разблокировать указанного пользователя
3. WHEN модератор отправляет команду /mute с указанием пользователя и времени THEN CORTES SHALL заглушить указанного пользователя на указанный срок
4. WHEN модератор отправляет команду /unmute THEN CORTES SHALL снять заглушение с указанного пользователя
5. WHEN модератор отправляет команду /kick THEN CORTES SHALL удалить указанного пользователя из чата
6. WHEN модератор отправляет команду /warn с причиной THEN CORTES SHALL выдать предупреждение пользователю и записать причину
7. WHEN модератор отправляет команду /unwarn THEN CORTES SHALL снять последнее предупреждение с пользователя
8. WHEN модератор использует команду в ответ на сообщение THEN CORTES SHALL применить действие к автору этого сообщения

---

### Requirement 5: Система предупреждений

**User Story:** Как владелец чата, я хочу настроить автоматический бан при накоплении предупреждений, чтобы систематические нарушители автоматически блокировались.

#### Acceptance Criteria

1. WHEN пользователь получает количество предупреждений равное лимиту THEN CORTES SHALL автоматически заблокировать пользователя на настроенный срок
2. WHEN происходит автобан THEN CORTES SHALL отправить в чат настроенное сообщение с информацией о бане (пользователь, срок, причина, количество предупреждений)
3. WHEN проходит настроенное количество дней без новых предупреждений THEN CORTES SHALL автоматически снять одно предупреждение с пользователя
4. WHEN несколько модераторов пытаются выдать предупреждение за одно сообщение THEN CORTES SHALL выдать только одно предупреждение и уведомить остальных модераторов
5. WHEN владелец изменяет лимит предупреждений до бана THEN CORTES SHALL применить новый лимит для всех последующих проверок

---

### Requirement 6: Фильтр стоп-слов

**User Story:** Как владелец чата, я хочу автоматически удалять сообщения с запрещёнными словами, чтобы поддерживать чистоту общения.

#### Acceptance Criteria

1. WHEN пользователь отправляет сообщение содержащее стоп-слово THEN CORTES SHALL удалить сообщение и отправить настроенное предупреждение
2. WHEN владелец добавляет новое стоп-слово THEN CORTES SHALL начать фильтровать сообщения по этому слову
3. WHEN владелец удаляет стоп-слово THEN CORTES SHALL прекратить фильтрацию по этому слову
4. WHEN владелец изменяет текст предупреждения THEN CORTES SHALL использовать новый текст при удалении сообщений
5. WHEN владелец отключает фильтр стоп-слов THEN CORTES SHALL прекратить проверку сообщений на стоп-слова

---

### Requirement 7: Фильтр каналов

**User Story:** Как владелец чата, я хочу блокировать репосты из определённых каналов, чтобы предотвратить нежелательную рекламу.

#### Acceptance Criteria

1. WHEN пользователь делает репост из заблокированного канала THEN CORTES SHALL удалить репост и отправить настроенное предупреждение
2. WHEN пользователь пишет сообщение от имени канала (не личного аккаунта) THEN CORTES SHALL удалить сообщение и предупредить о запрете
3. WHEN владелец добавляет канал в чёрный список THEN CORTES SHALL начать блокировать репосты из этого канала
4. WHEN владелец удаляет канал из чёрного списка THEN CORTES SHALL разрешить репосты из этого канала
5. WHEN владелец отключает фильтр каналов THEN CORTES SHALL разрешить все репосты

---

### Requirement 8: Фильтр медиа

**User Story:** Как владелец чата, я хочу контролировать типы медиа-контента в чате, чтобы поддерживать нужный формат общения.

#### Acceptance Criteria

1. WHEN пользователь отправляет голосовое сообщение И блокировка голосовых включена THEN CORTES SHALL удалить голосовое сообщение
2. WHEN пользователь отправляет видео-кружок И блокировка кружков включена THEN CORTES SHALL удалить видео-кружок
3. WHEN пользователь отправляет стикер И блокировка стикеров включена THEN CORTES SHALL удалить стикер
4. WHEN владелец включает/отключает блокировку типа медиа THEN CORTES SHALL применить настройку немедленно

---

### Requirement 9: NSFW фильтр

**User Story:** Как владелец чата, я хочу автоматически удалять откровенный контент, чтобы чат оставался безопасным для всех участников.

#### Acceptance Criteria

1. WHEN пользователь отправляет изображение с NSFW контентом И фильтр включён THEN CORTES SHALL удалить изображение и предупредить пользователя
2. WHEN пользователь отправляет видео с NSFW контентом И фильтр включён THEN CORTES SHALL удалить видео и предупредить пользователя
3. WHEN владелец отключает NSFW фильтр THEN CORTES SHALL прекратить проверку контента на NSFW

---

### Requirement 10: Face-контроль

**User Story:** Как владелец чата, я хочу проверять новых участников перед допуском в чат, чтобы отсеивать ботов и нежелательных пользователей.

#### Acceptance Criteria

1. WHEN новый пользователь без аватара пытается вступить И требование аватара включено THEN CORTES SHALL отклонить заявку на вступление
2. WHEN новый пользователь без username пытается вступить И требование username включено THEN CORTES SHALL отклонить заявку на вступление
3. WHEN имя пользователя короче минимальной длины THEN CORTES SHALL отклонить заявку на вступление
4. WHEN аватар пользователя содержит NSFW контент И проверка NSFW аватара включена THEN CORTES SHALL отклонить заявку на вступление
5. WHEN анкетирование включено И пользователь проходит базовые проверки THEN CORTES SHALL отправить пользователю анкету с вопросами
6. WHEN пользователь отвечает на анкету THEN CORTES SHALL отправить ответы модераторам для принятия решения
7. WHEN модератор принимает заявку THEN CORTES SHALL допустить пользователя в чат
8. WHEN модератор отклоняет заявку THEN CORTES SHALL уведомить пользователя об отказе
9. WHEN модератор блокирует заявку THEN CORTES SHALL заблокировать пользователя без возможности повторной подачи

---

### Requirement 11: Правила чата

**User Story:** Как участник чата, я хочу просматривать правила чата по команде, чтобы знать нормы поведения в сообществе.

#### Acceptance Criteria

1. WHEN пользователь отправляет команду /rules THEN CORTES SHALL отправить текст правил чата
2. WHEN владелец изменяет текст правил THEN CORTES SHALL использовать обновлённый текст при вызове команды

---

### Requirement 12: Система жалоб

**User Story:** Как участник чата, я хочу сообщать о нарушениях модераторам, чтобы они могли оперативно реагировать.

#### Acceptance Criteria

1. WHEN пользователь отправляет команду /report в ответ на сообщение THEN CORTES SHALL переслать жалобу всем модераторам чата
2. WHEN модератор получает жалобу THEN CORTES SHALL предоставить кнопки для быстрых действий (warn/mute/ban/dismiss)

---

### Requirement 13: Тихий режим

**User Story:** Как модератор, я хочу временно ограничить возможность писать в чат, чтобы успокоить ситуацию при конфликтах.

#### Acceptance Criteria

1. WHEN модератор отправляет команду /ro THEN CORTES SHALL включить тихий режим и удалять все сообщения от не-администраторов
2. WHEN модератор отправляет команду /roof THEN CORTES SHALL отключить тихий режим и разрешить всем писать
3. WHILE тихий режим активен THEN CORTES SHALL разрешать сообщения только от владельца, админов и модераторов

---

### Requirement 14: Управление ролями

**User Story:** Как владелец чата, я хочу назначать роли участникам, чтобы делегировать обязанности по модерации.

#### Acceptance Criteria

1. WHEN владелец назначает пользователя админом THEN CORTES SHALL предоставить пользователю права админа
2. WHEN владелец назначает пользователя модератором THEN CORTES SHALL предоставить пользователю права модератора
3. WHEN владелец снимает роль с пользователя THEN CORTES SHALL отозвать соответствующие права
4. WHEN изменяется роль пользователя THEN CORTES SHALL записать действие в журнал

---

### Requirement 15: Журнал действий

**User Story:** Как владелец чата, я хочу просматривать историю действий модераторов, чтобы контролировать работу команды.

#### Acceptance Criteria

1. WHEN модератор выполняет действие (ban/mute/kick/warn/role change) THEN CORTES SHALL записать действие в журнал с указанием времени, исполнителя, цели и причины
2. WHEN владелец запрашивает журнал THEN CORTES SHALL отобразить список последних действий с фильтрацией по типу
3. WHEN сообщение удаляется автоматически THEN CORTES SHALL записать в журнал причину удаления

---

### Requirement 16: История сообщений

**User Story:** Как модератор, я хочу просматривать историю сообщений включая удалённые, чтобы расследовать инциденты.

#### Acceptance Criteria

1. WHEN модератор запрашивает историю сообщений THEN CORTES SHALL отобразить последние сообщения с отметками об удалённых
2. WHEN сообщение было удалено THEN CORTES SHALL показать причину удаления рядом с сообщением

---

### Requirement 17: База знаний бота (Мозг)

**User Story:** Как владелец чата, я хочу видеть как бот воспринимает мой чат и корректировать его поведение, чтобы улучшить качество взаимодействия.

#### Acceptance Criteria

1. WHEN владелец открывает раздел "Мозг" THEN CORTES SHALL отобразить информацию о восприятии чата (тон общения, основные темы, активные часы, выученные паттерны)
2. WHEN владелец вводит инструкцию по корректировке поведения THEN CORTES SHALL применить инструкцию к своим ответам в данном чате
3. WHEN бот изучает новый паттерн поведения чата THEN CORTES SHALL добавить его в список выученных паттернов

---

### Requirement 18: Тарифные планы

**User Story:** Как владелец чата, я хочу управлять подпиской на бота, чтобы получить доступ к расширенным функциям.

#### Acceptance Criteria

1. WHEN владелец открывает раздел "Тариф" THEN CORTES SHALL отобразить текущий тариф, дату окончания и доступные функции
2. WHEN владелец выбирает новый тариф THEN CORTES SHALL перенаправить на страницу оплаты
3. WHEN оплата успешно проведена THEN CORTES SHALL активировать новый тариф и разблокировать соответствующие функции
4. WHEN срок тарифа истекает THEN CORTES SHALL уведомить владельца и ограничить функционал до базового

---

### Requirement 19: RPG-система

**User Story:** Как участник чата, я хочу получать опыт и уровни за активность, чтобы геймифицировать общение.

#### Acceptance Criteria

1. WHEN пользователь отправляет сообщение THEN CORTES SHALL начислить опыт согласно правилам RPG-системы
2. WHEN пользователь набирает достаточно опыта THEN CORTES SHALL повысить уровень пользователя и уведомить об этом
3. WHEN пользователь выполняет квест THEN CORTES SHALL начислить бонусный опыт и отметить квест выполненным
4. WHEN пользователь получает предупреждение THEN CORTES SHALL уменьшить показатель симпатии

---

### Requirement 20: Авторизация через Telegram

**User Story:** Как пользователь, я хочу входить в личный кабинет через Telegram, чтобы не создавать отдельный аккаунт.

#### Acceptance Criteria

1. WHEN пользователь нажимает кнопку входа THEN CORTES SHALL отобразить виджет авторизации Telegram
2. WHEN пользователь подтверждает авторизацию в Telegram THEN CORTES SHALL создать сессию и перенаправить в личный кабинет
3. WHEN сессия истекает THEN CORTES SHALL запросить повторную авторизацию
