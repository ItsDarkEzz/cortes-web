import{r as d,j as e,m as D}from"./vendor-motion-D0gEqtNn.js";import{i as S,z as B,b as r}from"./index-aSmLva6P.js";import{D as I}from"./DashboardLayout-Bpew1iRb.js";import{I as c}from"./index-CpZSP-O-.js";import{D as L,a as k,b as T,c as A,d as P,e as z,f as O}from"./dialog-CzbwG9R-.js";import{S as R,a as U,b as E,c as F,d as M}from"./select-Bu0P6vpf.js";import{c as V,d as $,e as G}from"./use-owner-BYwwTJLW.js";import{A as H}from"./arrow-left-B8uwMu6i.js";import{B as j}from"./ban-CilfwISn.js";import{P as W}from"./plus-BQA9EFu6.js";import{L as f}from"./settings-BpBPvRo7.js";import{S as q}from"./search-CpZB0F_7.js";import{U as J}from"./user-CNcL3bhD.js";import{C as K}from"./calendar-r31YOpGh.js";import{C as Q}from"./clock-Cswu4yIg.js";import{T as X}from"./trash-2-D92CDgzm.js";import"./vendor-react-Bzgz95E1.js";import"./vendor-ui-Uwvs5CZw.js";import"./check-BSVgkHIg.js";const v={spam:"Спам",abuse:"Оскорбления",nsfw:"NSFW контент",scam:"Мошенничество",flood:"Флуд",other:"Другое"},Y={spam:"bg-yellow-500/10 text-yellow-400",abuse:"bg-red-500/10 text-red-400",nsfw:"bg-pink-500/10 text-pink-400",scam:"bg-orange-500/10 text-orange-400",flood:"bg-blue-500/10 text-blue-400",other:"bg-gray-500/10 text-gray-400"};function fe(){const[,N]=S(),[h,_]=d.useState(""),[l,u]=d.useState(1),[y,m]=d.useState(!1),[a,i]=d.useState({telegram_user_id:"",reason:"other",reason_text:"",duration_days:""}),{data:t,isLoading:w}=V({page:l,search:h}),x=$(),g=G(),{toast:n}=B(),b=async()=>{if(!a.telegram_user_id){n({title:"Ошибка",description:"Укажите Telegram ID",variant:"destructive"});return}try{await x.mutateAsync({telegram_user_id:parseInt(a.telegram_user_id),reason:a.reason,reason_text:a.reason_text||void 0,duration_days:a.duration_days?parseInt(a.duration_days):void 0}),n({title:"Успешно",description:"Пользователь заблокирован"}),m(!1),i({telegram_user_id:"",reason:"other",reason_text:"",duration_days:""})}catch{n({title:"Ошибка",description:"Не удалось заблокировать",variant:"destructive"})}},C=async s=>{try{await g.mutateAsync(s),n({title:"Успешно",description:"Блокировка снята"})}catch{n({title:"Ошибка",description:"Не удалось снять блокировку",variant:"destructive"})}},p=s=>new Date(s).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col h-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>N("/dashboard/owner"),children:e.jsx(H,{className:"w-5 h-5"})}),e.jsx(j,{className:"w-6 h-6 text-red-400"}),e.jsx("h1",{className:"text-xl font-bold",children:"Глобальные баны"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",t?.pagination.total||0,")"]})]}),e.jsxs(L,{open:y,onOpenChange:m,children:[e.jsx(k,{asChild:!0,children:e.jsxs(r,{className:"gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Добавить бан"]})}),e.jsxs(T,{children:[e.jsxs(A,{children:[e.jsx(P,{children:"Заблокировать пользователя"}),e.jsx(z,{children:"Пользователь не сможет взаимодействовать с ботом во всех чатах"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Telegram ID"}),e.jsx(c,{placeholder:"123456789",value:a.telegram_user_id,onChange:s=>i({...a,telegram_user_id:s.target.value}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Причина"}),e.jsxs(R,{value:a.reason,onValueChange:s=>i({...a,reason:s}),children:[e.jsx(U,{className:"mt-1",children:e.jsx(E,{})}),e.jsx(F,{children:Object.entries(v).map(([s,o])=>e.jsx(M,{value:s,children:o},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Комментарий (опционально)"}),e.jsx(c,{placeholder:"Дополнительная информация...",value:a.reason_text,onChange:s=>i({...a,reason_text:s.target.value}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Срок (дней, пусто = навсегда)"}),e.jsx(c,{type:"number",placeholder:"Навсегда",value:a.duration_days,onChange:s=>i({...a,duration_days:s.target.value}),className:"mt-1"})]})]}),e.jsxs(O,{children:[e.jsx(r,{variant:"outline",onClick:()=>m(!1),children:"Отмена"}),e.jsxs(r,{onClick:b,disabled:x.isPending,className:"bg-red-500 hover:bg-red-600",children:[x.isPending&&e.jsx(f,{className:"w-4 h-4 mr-2 animate-spin"}),"Заблокировать"]})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Поиск по ID или имени...",value:h,onChange:s=>_(s.target.value),className:"pl-9 bg-white/5 border-white/10"})]}),e.jsx("div",{className:"flex-1 overflow-auto space-y-2",children:w?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-primary"})}):t?.bans&&t.bans.length>0?t.bans.map((s,o)=>e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.03},className:"p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:s.first_name||s.username||`ID: ${s.telegram_user_id}`}),s.username&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["@",s.username]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ID: ",s.telegram_user_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${Y[s.reason]}`,children:v[s.reason]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(K,{className:"w-3 h-3"}),p(s.banned_at)]}),s.is_permanent?e.jsx("span",{className:"text-red-400",children:"Навсегда"}):s.expires_at&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-400",children:[e.jsx(Q,{className:"w-3 h-3"}),"до ",p(s.expires_at)]})]}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>C(s.telegram_user_id),disabled:g.isPending,className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:e.jsx(X,{className:"w-4 h-4"})})]})]}),s.reason_text&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground pl-14",children:s.reason_text})]},s.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[e.jsx(j,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"Нет заблокированных пользователей"})]})}),t&&t.pagination.pages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>u(s=>Math.max(1,s-1)),disabled:l===1,children:"Назад"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l," / ",t.pagination.pages]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>u(s=>Math.min(t.pagination.pages,s+1)),disabled:l===t.pagination.pages,children:"Вперёд"})]})]})})}export{fe as default};
