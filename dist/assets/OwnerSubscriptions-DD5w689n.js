import{r as n,j as e,m as U}from"./vendor-motion-D0gEqtNn.js";import{i as F,z as V,b as i}from"./index-aSmLva6P.js";import{D as $}from"./DashboardLayout-Bpew1iRb.js";import{I as p}from"./index-CpZSP-O-.js";import{D as B,a as E,b as M,c as R,d as H,e as X,f as q}from"./dialog-CzbwG9R-.js";import{S as N,a as _,b as w,c as y,d as c}from"./select-Bu0P6vpf.js";import{S as G}from"./switch-CgzmolH0.js";import{i as J,j as K,k as Q}from"./use-owner-BYwwTJLW.js";import{A as W}from"./arrow-left-B8uwMu6i.js";import{C as b}from"./credit-card-CzzVRL6p.js";import{D as Y}from"./dollar-sign-D7naHw4N.js";import{P as Z}from"./plus-BQA9EFu6.js";import{L as C}from"./settings-BpBPvRo7.js";import{S as ee}from"./search-CpZB0F_7.js";import{C as se}from"./clock-Cswu4yIg.js";import{C as S}from"./circle-x-D9u53cuK.js";import{C as ae}from"./circle-check-big-BqcJMtbJ.js";import{U as te}from"./user-CNcL3bhD.js";import{C as ie}from"./calendar-r31YOpGh.js";import"./vendor-react-Bzgz95E1.js";import"./vendor-ui-Uwvs5CZw.js";import"./check-BSVgkHIg.js";const D={active:{label:"Активна",color:"text-green-400",icon:ae},expired:{label:"Истекла",color:"text-red-400",icon:S},cancelled:{label:"Отменена",color:"text-gray-400",icon:S},pending:{label:"Ожидание",color:"text-yellow-400",icon:se}},re=[{id:"free",name:"Бесплатный"},{id:"premium",name:"Премиум"},{id:"unlimited",name:"Безлимит"}];function Ie(){const[,I]=F(),[h,k]=n.useState(""),[m,L]=n.useState("all"),[d,j]=n.useState(1),[A,x]=n.useState(!1),[a,r]=n.useState({telegram_user_id:"",plan_id:"premium",duration_days:"30",auto_renew:!0}),{data:t,isLoading:P}=J({page:d,search:h,status:m!=="all"?m:void 0}),u=K(),g=Q(),{toast:l}=V(),T=async()=>{if(!a.telegram_user_id){l({title:"Ошибка",description:"Укажите Telegram ID",variant:"destructive"});return}try{await u.mutateAsync({telegram_user_id:parseInt(a.telegram_user_id),plan_id:a.plan_id,duration_days:parseInt(a.duration_days),auto_renew:a.auto_renew}),l({title:"Успешно",description:"Подписка создана"}),x(!1),r({telegram_user_id:"",plan_id:"premium",duration_days:"30",auto_renew:!0})}catch{l({title:"Ошибка",description:"Не удалось создать подписку",variant:"destructive"})}},z=async s=>{try{await g.mutateAsync({id:s,data:{status:"cancelled"}}),l({title:"Успешно",description:"Подписка отменена"})}catch{l({title:"Ошибка",description:"Не удалось отменить подписку",variant:"destructive"})}},f=s=>new Date(s).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"});return e.jsx($,{children:e.jsxs("div",{className:"flex flex-col h-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>I("/dashboard/owner"),children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx(b,{className:"w-6 h-6 text-purple-400"}),e.jsx("h1",{className:"text-xl font-bold",children:"Подписки"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",t?.pagination.total||0,")"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"w-4 h-4 text-green-400"}),e.jsxs("span",{className:"text-green-400 font-medium",children:[t?.total_revenue?.toLocaleString()||0," ₽"]}),e.jsx("span",{className:"text-muted-foreground",children:"выручка"})]}),e.jsxs(B,{open:A,onOpenChange:x,children:[e.jsx(E,{asChild:!0,children:e.jsxs(i,{className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Добавить"]})}),e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(H,{children:"Создать подписку"}),e.jsx(X,{children:"Выдать подписку пользователю вручную"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Telegram ID"}),e.jsx(p,{placeholder:"123456789",value:a.telegram_user_id,onChange:s=>r({...a,telegram_user_id:s.target.value}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"План"}),e.jsxs(N,{value:a.plan_id,onValueChange:s=>r({...a,plan_id:s}),children:[e.jsx(_,{className:"mt-1",children:e.jsx(w,{})}),e.jsx(y,{children:re.map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Срок (дней)"}),e.jsx(p,{type:"number",value:a.duration_days,onChange:s=>r({...a,duration_days:s.target.value}),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Автопродление"}),e.jsx(G,{checked:a.auto_renew,onCheckedChange:s=>r({...a,auto_renew:s})})]})]}),e.jsxs(q,{children:[e.jsx(i,{variant:"outline",onClick:()=>x(!1),children:"Отмена"}),e.jsxs(i,{onClick:T,disabled:u.isPending,children:[u.isPending&&e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Создать"]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Поиск по ID или имени...",value:h,onChange:s=>k(s.target.value),className:"pl-9 bg-white/5 border-white/10"})]}),e.jsxs(N,{value:m,onValueChange:L,children:[e.jsx(_,{className:"w-[150px] bg-white/5 border-white/10",children:e.jsx(w,{placeholder:"Статус"})}),e.jsxs(y,{children:[e.jsx(c,{value:"all",children:"Все статусы"}),e.jsx(c,{value:"active",children:"Активные"}),e.jsx(c,{value:"expired",children:"Истёкшие"}),e.jsx(c,{value:"cancelled",children:"Отменённые"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto space-y-2",children:P?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-primary"})}):t?.subscriptions&&t.subscriptions.length>0?t.subscriptions.map((s,v)=>{const o=D[s.status]||D.pending,O=o.icon;return e.jsxs(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:v*.03},className:"p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:s.first_name||s.username||`ID: ${s.telegram_user_id}`}),s.username&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["@",s.username]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ID: ",s.telegram_user_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-primary/10 text-primary text-sm font-medium",children:s.plan_name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:`w-4 h-4 ${o.color}`}),e.jsx("span",{className:`text-sm ${o.color}`,children:o.label})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ie,{className:"w-3 h-3"}),f(s.started_at)]}),s.expires_at&&e.jsxs("div",{className:"text-muted-foreground",children:["до ",f(s.expires_at)]})]}),s.status==="active"&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>z(s.id),disabled:g.isPending,className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:"Отменить"})]})]}),s.auto_renew&&s.status==="active"&&e.jsx("p",{className:"mt-2 text-xs text-muted-foreground pl-14",children:"Автопродление включено"})]},s.id)}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[e.jsx(b,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"Нет подписок"})]})}),t&&t.pagination.pages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>j(s=>Math.max(1,s-1)),disabled:d===1,children:"Назад"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[d," / ",t.pagination.pages]}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>j(s=>Math.min(t.pagination.pages,s+1)),disabled:d===t.pagination.pages,children:"Вперёд"})]})]})})}export{Ie as default};
