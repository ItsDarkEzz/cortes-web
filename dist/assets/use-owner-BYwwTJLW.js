import{y as s,t as c,v as l,w as u}from"./index-aSmLva6P.js";const n={getStats:()=>s.get("/owner/stats"),getLLMUsage:(e="24h")=>s.get(`/owner/llm-usage?period=${e}`),getLogs:(e={})=>{const t=new URLSearchParams;return e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.level&&t.set("level",e.level),e.source&&t.set("source",e.source),e.chat_id&&t.set("chat_id",String(e.chat_id)),e.user_id&&t.set("user_id",String(e.user_id)),e.search&&t.set("search",e.search),s.get(`/owner/logs?${t.toString()}`)},getChats:(e={})=>{const t=new URLSearchParams;return e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.search&&t.set("search",e.search),e.active_only&&t.set("active_only","true"),e.chat_type&&e.chat_type!=="all"&&t.set("chat_type",e.chat_type),s.get(`/owner/chats?${t.toString()}`)},leaveChat:(e,t=!0,i)=>s.post("/owner/chats/leave",{telegram_chat_id:e,notify:t,message:i}),getChatDetails:e=>s.get(`/owner/chats/${e}`),updateChatSettings:(e,t)=>s.patch(`/owner/chats/${e}/settings`,t),getChatAvatarUrl:e=>`/v1/owner/chats/${e}/avatar`,getUserAvatarUrl:e=>`/v1/owner/users/${e}/avatar`,getBans:(e={})=>{const t=new URLSearchParams;return e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.search&&t.set("search",e.search),s.get(`/owner/bans?${t.toString()}`)},createBan:e=>s.post("/owner/bans",e),removeBan:e=>s.delete(`/owner/bans/${e}`),checkBan:e=>s.get(`/owner/bans/check/${e}`),getSubscriptions:(e={})=>{const t=new URLSearchParams;return e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.status&&t.set("status",e.status),e.search&&t.set("search",e.search),s.get(`/owner/subscriptions?${t.toString()}`)},createSubscription:e=>s.post("/owner/subscriptions",e),updateSubscription:(e,t)=>s.patch(`/owner/subscriptions/${e}`,t),sendBroadcast:e=>s.post("/owner/broadcast",e)};class g{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.onMessage=null,this.onStatusChange=null}connect(t){let r;"/v1".startsWith("http://")?r="/v1".replace("http://","ws://"):"/v1".startsWith("https://")?r="/v1".replace("https://","wss://"):r=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`,r=r.replace(/\/v1$/,"");const h=`${r}/v1/owner/logs/ws?token=${t}`;console.log("Connecting to WebSocket:",h);try{this.ws=new WebSocket(h),this.ws.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.onStatusChange?.(!0)},this.ws.onmessage=o=>{try{const a=JSON.parse(o.data);a.type==="log"&&this.onMessage?this.onMessage(a):a.type==="connected"&&console.log("WebSocket: ",a.message)}catch(a){console.error("Failed to parse WebSocket message:",a)}},this.ws.onclose=o=>{console.log("WebSocket disconnected:",o.code,o.reason),this.onStatusChange?.(!1),o.code!==4001&&o.code!==4003&&this.tryReconnect(t)},this.ws.onerror=o=>{console.error("WebSocket error:",o)}}catch(o){console.error("Failed to create WebSocket:",o),this.onStatusChange?.(!1)}}tryReconnect(t){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;const i=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);console.log(`Reconnecting in ${i}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>this.connect(t),i)}}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}setOnMessage(t){this.onMessage=t}setOnStatusChange(t){this.onStatusChange=t}sendPing(){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"ping"}))}}const y=new g;function S(){return c({queryKey:["owner","stats"],queryFn:()=>n.getStats(),refetchInterval:3e4})}function f(e="24h"){return c({queryKey:["owner","llm-usage",e],queryFn:()=>n.getLLMUsage(e)})}function p(e={}){return c({queryKey:["owner","logs",e],queryFn:()=>n.getLogs(e),refetchInterval:5e3})}function d(e={}){return c({queryKey:["owner","chats",e],queryFn:()=>n.getChats(e)})}function b(e){return c({queryKey:["owner","chat",e],queryFn:()=>n.getChatDetails(e),enabled:!!e})}function v(){const e=l();return u({mutationFn:({chatId:t,notify:i,message:r})=>n.leaveChat(t,i,r),onSuccess:()=>{e.invalidateQueries({queryKey:["owner","chats"]}),e.invalidateQueries({queryKey:["owner","stats"]})}})}function q(e={}){return c({queryKey:["owner","bans",e],queryFn:()=>n.getBans(e)})}function C(){const e=l();return u({mutationFn:t=>n.createBan(t),onSuccess:()=>{e.invalidateQueries({queryKey:["owner","bans"]}),e.invalidateQueries({queryKey:["owner","stats"]})}})}function U(){const e=l();return u({mutationFn:t=>n.removeBan(t),onSuccess:()=>{e.invalidateQueries({queryKey:["owner","bans"]}),e.invalidateQueries({queryKey:["owner","stats"]})}})}function $(e={}){return c({queryKey:["owner","subscriptions",e],queryFn:()=>n.getSubscriptions(e)})}function B(){const e=l();return u({mutationFn:t=>n.createSubscription(t),onSuccess:()=>{e.invalidateQueries({queryKey:["owner","subscriptions"]})}})}function F(){const e=l();return u({mutationFn:({id:t,data:i})=>n.updateSubscription(t,i),onSuccess:()=>{e.invalidateQueries({queryKey:["owner","subscriptions"]})}})}function K(){return u({mutationFn:e=>n.sendBroadcast(e)})}export{f as a,p as b,q as c,C as d,U as e,d as f,v as g,b as h,$ as i,B as j,F as k,y as l,K as m,n as o,S as u};
