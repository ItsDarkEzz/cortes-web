import{r as i,R as X,j as e,m as ye}from"./vendor-motion-D0gEqtNn.js";import{D as G,i as Ce,z as Ie,b as C,U as Re,a as Te}from"./index-aSmLva6P.js";import{D as _e}from"./DashboardLayout-Bpew1iRb.js";import{I as B}from"./index-CpZSP-O-.js";import{S as V}from"./switch-CgzmolH0.js";import{e as J,a as Q,i as Se,j as W,k as F,u as Ee,l as Z,d as Fe,m as Ae}from"./vendor-ui-Uwvs5CZw.js";import{D as De,b as Le,c as Pe,d as ke,e as $e,f as Me}from"./dialog-CzbwG9R-.js";import{f as Oe,g as Ue,o as Ge}from"./use-owner-BYwwTJLW.js";import{U as z,A as Ke,a as Be,b as Ve}from"./avatar-DNWj6Ucy.js";import{A as ze}from"./arrow-left-B8uwMu6i.js";import{S as $}from"./server-CnjzAo2-.js";import{U as H}from"./user-CNcL3bhD.js";import{S as He}from"./search-CpZB0F_7.js";import{L as Y}from"./settings-BpBPvRo7.js";import{A as q}from"./activity-BOauTYxt.js";import{C as Ye}from"./circle-check-big-BqcJMtbJ.js";import{C as qe}from"./circle-x-D9u53cuK.js";import{E as Xe}from"./external-link-rPxT9hSa.js";import{L as Je}from"./log-out-CVVjutJH.js";import{C as Qe}from"./calendar-r31YOpGh.js";import"./vendor-react-Bzgz95E1.js";function M(t,o,{checkForDefaultPrevented:s=!0}={}){return function(c){if(t?.(c),s===!1||!c.defaultPrevented)return o?.(c)}}function E(t,o,{checkForDefaultPrevented:s=!0}={}){return function(c){if(t?.(c),s===!1||!c.defaultPrevented)return o?.(c)}}var We=X[" useInsertionEffect ".trim().toString()]||J;function Ze({prop:t,defaultProp:o,onChange:s=()=>{},caller:a}){const[c,d,f]=et({defaultProp:o,onChange:s}),l=t!==void 0,x=l?t:c;{const r=i.useRef(t!==void 0);i.useEffect(()=>{const u=r.current;u!==l&&console.warn(`${a} is changing from ${u?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),r.current=l},[l,a])}const m=i.useCallback(r=>{if(l){const u=tt(r)?r(t):r;u!==t&&f.current?.(u)}else d(r)},[l,t,d,f]);return[x,m]}function et({defaultProp:t,onChange:o}){const[s,a]=i.useState(t),c=i.useRef(s),d=i.useRef(o);return We(()=>{d.current=o},[o]),i.useEffect(()=>{c.current!==s&&(d.current?.(s),c.current=s)},[s,c]),[s,a,d]}function tt(t){return typeof t=="function"}var O="rovingFocusGroup.onEntryFocus",st={bubbles:!1,cancelable:!0},D="RovingFocusGroup",[U,ee,ot]=Se(D),[at,te]=Q(D,[ot]),[nt,rt]=at(D),se=i.forwardRef((t,o)=>e.jsx(U.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(U.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(it,{...t,ref:o})})}));se.displayName=D;var it=i.forwardRef((t,o)=>{const{__scopeRovingFocusGroup:s,orientation:a,loop:c=!1,dir:d,currentTabStopId:f,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:x,onEntryFocus:m,preventScrollOnEntryFocus:r=!1,...u}=t,p=i.useRef(null),N=Ee(o,p),I=Z(d),[g,v]=Ze({prop:f,defaultProp:l??null,onChange:x,caller:D}),[j,R]=i.useState(!1),b=Fe(m),w=ee(s),A=i.useRef(!1),[n,T]=i.useState(0);return i.useEffect(()=>{const h=p.current;if(h)return h.addEventListener(O,b),()=>h.removeEventListener(O,b)},[b]),e.jsx(nt,{scope:s,orientation:a,dir:I,loop:c,currentTabStopId:g,onItemFocus:i.useCallback(h=>v(h),[v]),onItemShiftTab:i.useCallback(()=>R(!0),[]),onFocusableItemAdd:i.useCallback(()=>T(h=>h+1),[]),onFocusableItemRemove:i.useCallback(()=>T(h=>h-1),[]),children:e.jsx(F.div,{tabIndex:j||n===0?-1:0,"data-orientation":a,...u,ref:N,style:{outline:"none",...t.style},onMouseDown:E(t.onMouseDown,()=>{A.current=!0}),onFocus:E(t.onFocus,h=>{const k=!A.current;if(h.target===h.currentTarget&&k&&!j){const _=new CustomEvent(O,st);if(h.currentTarget.dispatchEvent(_),!_.defaultPrevented){const S=w().filter(y=>y.focusable),je=S.find(y=>y.active),Ne=S.find(y=>y.id===g),we=[je,Ne,...S].filter(Boolean).map(y=>y.ref.current);ne(we,r)}}A.current=!1}),onBlur:E(t.onBlur,()=>R(!1))})})}),oe="RovingFocusGroupItem",ae=i.forwardRef((t,o)=>{const{__scopeRovingFocusGroup:s,focusable:a=!0,active:c=!1,tabStopId:d,children:f,...l}=t,x=W(),m=d||x,r=rt(oe,s),u=r.currentTabStopId===m,p=ee(s),{onFocusableItemAdd:N,onFocusableItemRemove:I,currentTabStopId:g}=r;return i.useEffect(()=>{if(a)return N(),()=>I()},[a,N,I]),e.jsx(U.ItemSlot,{scope:s,id:m,focusable:a,active:c,children:e.jsx(F.span,{tabIndex:u?0:-1,"data-orientation":r.orientation,...l,ref:o,onMouseDown:E(t.onMouseDown,v=>{a?r.onItemFocus(m):v.preventDefault()}),onFocus:E(t.onFocus,()=>r.onItemFocus(m)),onKeyDown:E(t.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){r.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const j=ut(v,r.orientation,r.dir);if(j!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let b=p().filter(w=>w.focusable).map(w=>w.ref.current);if(j==="last")b.reverse();else if(j==="prev"||j==="next"){j==="prev"&&b.reverse();const w=b.indexOf(v.currentTarget);b=r.loop?dt(b,w+1):b.slice(w+1)}setTimeout(()=>ne(b))}}),children:typeof f=="function"?f({isCurrentTabStop:u,hasTabStop:g!=null}):f})})});ae.displayName=oe;var ct={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function lt(t,o){return o!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function ut(t,o,s){const a=lt(t.key,s);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return ct[a]}function ne(t,o=!1){const s=document.activeElement;for(const a of t)if(a===s||(a.focus({preventScroll:o}),document.activeElement!==s))return}function dt(t,o){return t.map((s,a)=>t[(o+a)%t.length])}var ft=se,mt=ae,gt=X[" useInsertionEffect ".trim().toString()]||J;function vt({prop:t,defaultProp:o,onChange:s=()=>{},caller:a}){const[c,d,f]=ht({defaultProp:o,onChange:s}),l=t!==void 0,x=l?t:c;{const r=i.useRef(t!==void 0);i.useEffect(()=>{const u=r.current;u!==l&&console.warn(`${a} is changing from ${u?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),r.current=l},[l,a])}const m=i.useCallback(r=>{if(l){const u=xt(r)?r(t):r;u!==t&&f.current?.(u)}else d(r)},[l,t,d,f]);return[x,m]}function ht({defaultProp:t,onChange:o}){const[s,a]=i.useState(t),c=i.useRef(s),d=i.useRef(o);return gt(()=>{d.current=o},[o]),i.useEffect(()=>{c.current!==s&&(d.current?.(s),c.current=s)},[s,c]),[s,a,d]}function xt(t){return typeof t=="function"}var P="Tabs",[pt]=Q(P,[te]),re=te(),[bt,K]=pt(P),ie=i.forwardRef((t,o)=>{const{__scopeTabs:s,value:a,onValueChange:c,defaultValue:d,orientation:f="horizontal",dir:l,activationMode:x="automatic",...m}=t,r=Z(l),[u,p]=vt({prop:a,onChange:c,defaultProp:d??"",caller:P});return e.jsx(bt,{scope:s,baseId:W(),value:u,onValueChange:p,orientation:f,dir:r,activationMode:x,children:e.jsx(F.div,{dir:r,"data-orientation":f,...m,ref:o})})});ie.displayName=P;var ce="TabsList",le=i.forwardRef((t,o)=>{const{__scopeTabs:s,loop:a=!0,...c}=t,d=K(ce,s),f=re(s);return e.jsx(ft,{asChild:!0,...f,orientation:d.orientation,dir:d.dir,loop:a,children:e.jsx(F.div,{role:"tablist","aria-orientation":d.orientation,...c,ref:o})})});le.displayName=ce;var ue="TabsTrigger",de=i.forwardRef((t,o)=>{const{__scopeTabs:s,value:a,disabled:c=!1,...d}=t,f=K(ue,s),l=re(s),x=ge(f.baseId,a),m=ve(f.baseId,a),r=a===f.value;return e.jsx(mt,{asChild:!0,...l,focusable:!c,active:r,children:e.jsx(F.button,{type:"button",role:"tab","aria-selected":r,"aria-controls":m,"data-state":r?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:x,...d,ref:o,onMouseDown:M(t.onMouseDown,u=>{!c&&u.button===0&&u.ctrlKey===!1?f.onValueChange(a):u.preventDefault()}),onKeyDown:M(t.onKeyDown,u=>{[" ","Enter"].includes(u.key)&&f.onValueChange(a)}),onFocus:M(t.onFocus,()=>{const u=f.activationMode!=="manual";!r&&!c&&u&&f.onValueChange(a)})})})});de.displayName=ue;var fe="TabsContent",me=i.forwardRef((t,o)=>{const{__scopeTabs:s,value:a,forceMount:c,children:d,...f}=t,l=K(fe,s),x=ge(l.baseId,a),m=ve(l.baseId,a),r=a===l.value,u=i.useRef(r);return i.useEffect(()=>{const p=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(p)},[]),e.jsx(Ae,{present:c||r,children:({present:p})=>e.jsx(F.div,{"data-state":r?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":x,hidden:!p,id:m,tabIndex:0,...f,ref:o,style:{...t.style,animationDuration:u.current?"0s":void 0},children:p&&d})})});me.displayName=fe;function ge(t,o){return`${t}-trigger-${o}`}function ve(t,o){return`${t}-content-${o}`}var jt=ie,he=le,xe=de,pe=me;const Nt=jt,be=i.forwardRef(({className:t,...o},s)=>e.jsx(he,{ref:s,className:G("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...o}));be.displayName=he.displayName;const L=i.forwardRef(({className:t,...o},s)=>e.jsx(xe,{ref:s,className:G("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...o}));L.displayName=xe.displayName;const wt=i.forwardRef(({className:t,...o},s)=>e.jsx(pe,{ref:s,className:G("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...o}));wt.displayName=pe.displayName;function zt(){const[,t]=Ce(),[o,s]=i.useState(""),[a,c]=i.useState(!1),[d,f]=i.useState("all"),[l,x]=i.useState(1),[m,r]=i.useState({open:!1,chatId:0,title:""}),[u,p]=i.useState(""),[N,I]=i.useState(!0),{data:g,isLoading:v}=Oe({page:l,search:o,active_only:a,chat_type:d}),j=Ue(),{toast:R}=Ie(),b=async()=>{try{await j.mutateAsync({chatId:m.chatId,notify:N,message:u||void 0}),R({title:"Успешно",description:"Бот покинул чат"}),r({open:!1,chatId:0,title:""}),p("")}catch{R({title:"Ошибка",description:"Не удалось покинуть чат",variant:"destructive"})}},w=n=>new Date(n).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}),A=n=>{if(!n)return"Нет активности";const T=new Date(n),k=new Date().getTime()-T.getTime(),_=Math.floor(k/(1e3*60*60)),S=Math.floor(_/24);return S>0?`${S}д назад`:_>0?`${_}ч назад`:"Недавно"};return e.jsx(_e,{children:e.jsxs("div",{className:"flex flex-col h-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>t("/dashboard/owner"),children:e.jsx(ze,{className:"w-5 h-5"})}),e.jsx($,{className:"w-6 h-6 text-green-400"}),e.jsx("h1",{className:"text-xl font-bold",children:"Чаты бота"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",g?.total_chats||0," всего, ",g?.active_chats||0," активных)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Только активные"}),e.jsx(V,{checked:a,onCheckedChange:c})]})]}),e.jsx(Nt,{value:d,onValueChange:n=>{f(n),x(1)},children:e.jsxs(be,{className:"bg-white/5",children:[e.jsxs(L,{value:"all",className:"gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Все (",g?.total_chats||0,")"]}),e.jsxs(L,{value:"private",className:"gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Личные (",g?.private_chats||0,")"]}),e.jsxs(L,{value:"group",className:"gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Группы (",g?.group_chats||0,")"]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Поиск по названию чата...",value:o,onChange:n=>s(n.target.value),className:"pl-9 bg-white/5 border-white/10"})]}),e.jsx("div",{className:"flex-1 overflow-auto space-y-2",children:v?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Y,{className:"w-6 h-6 animate-spin text-primary"})}):g?.chats&&g.chats.length>0?g.chats.map((n,T)=>e.jsxs(ye.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:T*.03},className:"p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors cursor-pointer",onClick:()=>t(`/dashboard/owner/chats/${n.telegram_chat_id}`),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Ke,{className:"w-12 h-12",children:[e.jsx(Be,{src:Ge.getChatAvatarUrl(n.telegram_chat_id)}),e.jsx(Ve,{className:`${n.chat_type==="private"?"bg-gradient-to-br from-blue-500/20 to-purple-500/20":"bg-gradient-to-br from-green-500/20 to-teal-500/20"}`,children:n.chat_type==="private"?e.jsx(H,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(z,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-background ${n.is_active?"bg-green-500":"bg-gray-500"}`})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:n.title}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${n.chat_type==="private"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"}`,children:n.chat_type==="private"?"Личный":n.chat_type==="supergroup"?"Супергруппа":"Группа"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.username?`@${n.username} • `:"","ID: ",n.telegram_chat_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Re,{className:"w-4 h-4"}),n.members_count.toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Te,{className:"w-4 h-4"}),n.messages_count.toLocaleString()]}),n.messages_today>0&&e.jsxs("div",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(q,{className:"w-4 h-4"}),"+",n.messages_today," сегодня"]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[n.is_active?e.jsx(Ye,{className:"w-4 h-4 text-green-400"}):e.jsx(qe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:n.is_active?"text-green-400":"text-gray-400",children:n.is_active?"Активен":"Неактивен"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(q,{className:"w-3 h-3"}),A(n.last_activity)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:h=>{h.stopPropagation(),t(`/dashboard/owner/chats/${n.telegram_chat_id}`)},className:"text-muted-foreground hover:text-white",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx(C,{variant:"ghost",size:"icon",onClick:h=>{h.stopPropagation(),r({open:!0,chatId:n.telegram_chat_id,title:n.title})},className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:e.jsx(Je,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"mt-2 flex items-center gap-4 text-xs text-muted-foreground pl-16",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-3 h-3"}),"Добавлен: ",w(n.joined_at)]})})]},n.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[e.jsx($,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"Нет чатов"})]})}),g&&g.pagination.pages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:()=>x(n=>Math.max(1,n-1)),disabled:l===1,children:"Назад"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l," / ",g.pagination.pages]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>x(n=>Math.min(g.pagination.pages,n+1)),disabled:l===g.pagination.pages,children:"Вперёд"})]}),e.jsx(De,{open:m.open,onOpenChange:n=>r({...m,open:n}),children:e.jsxs(Le,{children:[e.jsxs(Pe,{children:[e.jsx(ke,{children:"Покинуть чат"}),e.jsxs($e,{children:['Бот выйдет из чата "',m.title,'"']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Отправить сообщение перед выходом"}),e.jsx(V,{checked:N,onCheckedChange:I})]}),N&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Сообщение (опционально)"}),e.jsx(B,{placeholder:"Бот покидает этот чат. До свидания!",value:u,onChange:n=>p(n.target.value),className:"mt-1"})]})]}),e.jsxs(Me,{children:[e.jsx(C,{variant:"outline",onClick:()=>r({open:!1,chatId:0,title:""}),children:"Отмена"}),e.jsxs(C,{onClick:b,disabled:j.isPending,className:"bg-red-500 hover:bg-red-600",children:[j.isPending&&e.jsx(Y,{className:"w-4 h-4 mr-2 animate-spin"}),"Покинуть чат"]})]})]})})]})})}export{zt as default};
