import{r as i,j as e,m as u}from"./vendor-motion-D0gEqtNn.js";import{D as f,i as v,z as w,b as o,U as N}from"./index-aSmLva6P.js";import{D as y}from"./DashboardLayout-Bpew1iRb.js";import{u as C,m as k}from"./use-owner-BYwwTJLW.js";import{A as L}from"./arrow-left-B8uwMu6i.js";import{S as h}from"./send-LUS9yrWD.js";import{C as S}from"./circle-check-big-BqcJMtbJ.js";import{L as T}from"./settings-BpBPvRo7.js";import"./vendor-react-Bzgz95E1.js";import"./vendor-ui-Uwvs5CZw.js";const b=i.forwardRef(({className:l,...t},a)=>e.jsx("textarea",{className:f("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",l),ref:a,...t}));b.displayName="Textarea";const _=[{value:"all",label:"Все чаты",description:"Отправить во все активные чаты"},{value:"subscribers",label:"Подписчики",description:"Только пользователи с подпиской"},{value:"chat_admins",label:"Админы чатов",description:"Только администраторы чатов"}];function P(){const[,l]=v(),[t,a]=i.useState(""),[r,p]=i.useState("all"),[n,m]=i.useState(null),{data:x}=C(),d=k(),{toast:c}=w(),g=async()=>{if(!t.trim()){c({title:"Ошибка",description:"Введите сообщение",variant:"destructive"});return}try{const s=await d.mutateAsync({message:t.trim(),target:r});m({taskId:s.task_id,count:s.target_count}),c({title:"Успешно",description:`Рассылка запущена на ${s.target_count} получателей`})}catch{c({title:"Ошибка",description:"Не удалось отправить рассылку",variant:"destructive"})}},j=()=>{if(!x)return 0;switch(r){case"all":return x.active_chats;case"subscribers":return"?";case"chat_admins":return"?";default:return 0}};return e.jsx(y,{children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>l("/dashboard/owner"),children:e.jsx(L,{className:"w-5 h-5"})}),e.jsx(h,{className:"w-6 h-6 text-orange-400"}),e.jsx("h1",{className:"text-xl font-bold",children:"Рассылка"})]}),n?e.jsxs(u.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"p-8 rounded-2xl bg-green-500/10 border border-green-500/20 text-center",children:[e.jsx(S,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Рассылка запущена!"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Сообщение отправляется ",n.count," получателям"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["ID задачи: ",n.taskId]}),e.jsx(o,{onClick:()=>{m(null),a("")},children:"Новая рассылка"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 rounded-2xl bg-white/5 border border-white/10",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Получатели"}),e.jsx("div",{className:"grid gap-3",children:_.map(s=>e.jsx(u.div,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>p(s.value),className:`p-4 rounded-xl border cursor-pointer transition-colors ${r===s.value?"bg-primary/10 border-primary":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${r===s.value?"border-primary bg-primary":"border-white/20"}`,children:r===s.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})})]})},s.value))}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsxs("span",{children:["Примерно ",j()," получателей"]})]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white/5 border border-white/10",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Сообщение"}),e.jsx(b,{placeholder:`Введите текст сообщения...

Поддерживается HTML разметка:
<b>жирный</b>, <i>курсив</i>, <code>код</code>`,value:t,onChange:s=>a(s.target.value),className:"min-h-[200px] bg-white/5 border-white/10"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[t.length," символов"]}),e.jsx("span",{children:"HTML разметка поддерживается"})]})]}),t&&e.jsxs("div",{className:"p-6 rounded-2xl bg-white/5 border border-white/10",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Предпросмотр"}),e.jsx("div",{className:"p-4 rounded-lg bg-black/20 prose prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:t}})]}),e.jsxs(o,{onClick:g,disabled:d.isPending||!t.trim(),className:"w-full h-12 text-lg gap-2",children:[d.isPending?e.jsx(T,{className:"w-5 h-5 animate-spin"}):e.jsx(h,{className:"w-5 h-5"}),"Отправить рассылку"]}),e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"⚠️ Рассылка будет отправлена немедленно. Убедитесь, что сообщение корректно."})]})]})})}export{P as default};
